"use strict";var weatherData=null,input=document.getElementById("searchInput"),searchButton=document.getElementById("searchBtn"),btnMetric=document.querySelector(".btn--metric");function isoToDate(e){var t;return t="weekday"===(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"full")?{weekday:"short"}:{weekday:"long",year:"numeric",month:"short",day:"numeric"},new Date(e).toLocaleDateString("en-US",t)}function formatHour(e){var t=new Date(e).getHours(),n=t>=12?" PM":" AM";return"".concat(t=0===(t%=12)?12:t).concat(n)}function updateWeatherUI(e){document.getElementById("time").textContent=isoToDate(e.current.time),document.getElementById("temperature").textContent=Math.round(e.current.temperature_2m)+"°",document.getElementById("weather-code-icon").src=weatherIcon(e.current.weather_code),document.getElementById("temperature-feels").textContent=Math.round(e.current.apparent_temperature)+e.current_units.apparent_temperature,document.getElementById("humidity").textContent=e.current.relative_humidity_2m+"%",document.getElementById("wind").textContent=Math.round(e.current.wind_speed_10m)+e.current_units.wind_speed_10m,document.getElementById("precipitation").textContent=e.current.precipitation+e.current_units.precipitation;var t=document.querySelector(".forecast_container");t.innerHTML="";for(var n=0;n<7;n++){var r=e.daily.time[n],a=e.daily.temperature_2m_max[n],o=e.daily.temperature_2m_min[n],c=weatherIcon(e.daily.weather_code[n]);t.innerHTML+='\n      <div class="card py-4 px-2.5">\n        <h3 class="card__title">\n          '.concat(isoToDate(r,"weekday"),'\n        </h3>\n        <img src="').concat(c,'" alt="Weather Icon" class="card__icon">\n        <div class="card__temperatures flex justify-between">\n          <p class="card__temperature">\n            ').concat(Math.round(a),"<sup>").concat(e.daily_units.temperature_2m_max,'</sup>\n          </p>\n          <p class="card__temperature card__temperature--low">\n            ').concat(Math.round(o),"<sup>").concat(e.daily_units.temperature_2m_max,"</sup>\n          </p>\n        </div>\n      </div>\n    ")}var i=document.querySelector(".hourly_container");i.innerHTML="";for(var u=new Date,s=e.hourly.time.findIndex(function(e){return new Date(e)>=u}),d=s;d<s+8;d++){var l=e.hourly.temperature_2m[d],m=weatherIcon(e.hourly.weather_code[d]),p=formatHour(e.hourly.time[d]);i.innerHTML+='\n      <div class="hourly_container card card--light flex flex-row items-center justify-between mt-4 py-2 px-3">\n        <div class="flex flex-row items-center">\n          <img src="'.concat(m,'" alt="" class="card__icon w-10">\n          <p class="card__hour ml-2">').concat(p,'</p>\n        </div>\n  \n        <p class="card__temperature">').concat(l,"<sup>°</sup></p>\n      </div>\n    ")}var h=document.querySelectorAll('input[name="select-days"]'),w=u.getDay();h.forEach(function(e){if(w===Number(e.value)){var t=e.closest("label");buttonDropdownDays.innerHTML="".concat(t.textContent.trim(),' <img class="dropdown-icon w-3.5" src="./assets/images/icon-dropdown.svg" />'),e.checked=!0}})}var dropdownDays=document.querySelector(".dropdown-days"),buttonDropdownDays=document.querySelector(".dropdown-button-days");function getNextDateForWeekday(e){var t=new Date;t.setHours(0,0,0,0);var n=e%7-t.getDay();n<0&&(n+=7);var r=new Date(t);return r.setDate(t.getDate()+n),r.setHours(9,0,0,0),r}function findStartIndexForSelectedDay(e){var t=getNextDateForWeekday(e);return weatherData.hourly.time.findIndex(function(e){return new Date(e).getTime()===t.getTime()})}function refreshHourlyForecast(e){var t=document.querySelector(".hourly_container");t.innerHTML="";var n=findStartIndexForSelectedDay(Number(e));if(-1!==n)for(var r=n;r<n+9;r++){var a=weatherData.hourly.temperature_2m[r],o=weatherIcon(weatherData.hourly.weather_code[r]),c=formatHour(weatherData.hourly.time[r]);t.innerHTML+='\n      <div class="hourly_container card card--light flex flex-row items-center justify-between mt-4 py-2 px-3">\n        <div class="flex flex-row items-center">\n          <img src="'.concat(o,'" alt="" class="card__icon w-10">\n          <p class="card__hour ml-2">').concat(c,'</p>\n        </div>\n        <p class="card__temperature">').concat(a,"<sup>°</sup></p>\n      </div>\n    ")}else console.warn("Aucune donnée trouvée pour ce jour")}function getSelectedDay(e){var t=new Date;return t.setHours(9,0,0,0),t.setDate(t.getDate()+e),t}function inputDaySelection(){document.querySelectorAll('input[name="select-days"]').forEach(function(e){e.addEventListener("change",function(e){e.target.checked&&refreshHourlyForecast(e.target.value)})})}function weatherIcon(e){return 0===e?"./assets/images/icon-sunny.webp":2===e?"./assets/images/icon-partly-cloudy.webp":1===e||3===e?"./assets/images/icon-overcast.webp":45===e||48===e?"./assets/images/icon-fog.webp":[51,53,55].includes(e)?"./assets/images/icon-drizzle.webp":[61,63,65,80,81,82].includes(e)?"./assets/images/icon-rain.webp":73===e?"./assets/images/icon-snow.webp":95===e?"./assets/images/icon-storm.webp":"./assets/images/icon-sunny.webp"}buttonDropdownDays.addEventListener("click",function(){dropdownDays.style.display="block"===dropdownDays.style.display?"none":"block"}),inputDaySelection();var dropdownUnit=document.querySelector(".dropdown-units"),buttonDropdownUnit=document.querySelector(".dropdown-button-units");buttonDropdownUnit.addEventListener("click",function(){dropdownUnit.style.display="block"===dropdownUnit.style.display?"none":"block"});var API_URL="localhost"===window.location.hostname?"http://localhost:3002":"https://weatherapp-frontendmentor-server.onrender.com";function fetchWeather(e){var t=e.value;return fetch("".concat(API_URL,"/api/search?q=").concat(encodeURIComponent(t))).then(function(e){return e.json()}).then(function(e){if(e.length){var t=e[0],n=t.lat,r=t.lon,a=t.display_name.split(","),o=a[0].trim()+", "+a[a.length-1].trim();document.getElementById("location").textContent=o;var c=buildMeteoUrl(n,r);return fetch(c)}alert("Aucun résultat trouvé !")})}var currentCity="Berlin",currentUnit="metric";searchButton.addEventListener("click",function(){var e=input.value;currentCity=e,refreshWeather()}),btnMetric.addEventListener("click",function(){currentUnit="metric"===currentUnit?"imperial":"metric",btnMetric.innerHTML="imperial"===currentUnit?"Switch to Metric":"Switch to Imperial","metric"===currentUnit?(weatherUnits.temperature="celsius",weatherUnits.wind="kmh",weatherUnits.precipitation="mm"):"imperial"===currentUnit&&(weatherUnits.temperature="fahrenheit",weatherUnits.wind="mph",weatherUnits.precipitation="in");var e=document.querySelector('input[name="temperature-unit"][value="'.concat(weatherUnits.temperature,'"]')),t=document.querySelector('input[name="wind-unit"][value="'.concat(weatherUnits.wind,'"]')),n=document.querySelector('input[name="precipitation-unit"][value="'.concat(weatherUnits.precipitation,'"]'));e&&(e.checked=!0),t&&(t.checked=!0),n&&(n.checked=!0),refreshWeather()});var weatherUnits={temperature:"celsius",wind:"kmh",precipitation:"mm"};function buildMeteoUrl(e,t){var n="https://api.open-meteo.com/v1/forecast?latitude=".concat(e,"&longitude=").concat(t,"&daily=weather_code,temperature_2m_max,temperature_2m_min&current=temperature_2m,relative_humidity_2m,precipitation,wind_speed_10m,apparent_temperature,weather_code&hourly=temperature_2m,weather_code&timezone=auto"),r=[];return"fahrenheit"===weatherUnits.temperature&&r.push("temperature_unit=fahrenheit"),"mph"===weatherUnits.wind&&r.push("wind_speed_unit=mph"),"in"===weatherUnits.precipitation&&r.push("precipitation_unit=inch"),r.length?"".concat(n,"&").concat(r.join("&")):n}function refreshWeather(){fetchWeather({value:currentCity}).then(function(e){return e.json()}).then(function(e){weatherData=e,updateWeatherUI(e)}).catch(function(e){return console.error(e)})}function handleRadioGroup(e,t){document.querySelectorAll(e).forEach(function(e){e.addEventListener("change",function(e){e.target.checked&&(weatherUnits[t]=e.target.value,refreshWeather())})})}handleRadioGroup('input[name="temperature-unit"]',"temperature"),handleRadioGroup('input[name="wind-unit"]',"wind"),handleRadioGroup('input[name="precipitation-unit"]',"precipitation");//# sourceMappingURL=script.js.map
