{"version":3,"sources":["script.js"],"names":["weatherData","input","document","getElementById","searchButton","btnMetric","querySelector","isoToDate","date","options","arguments","length","undefined","weekday","year","month","day","Date","toLocaleDateString","formatHour","time","hours","getHours","ampm","concat","updateWeatherUI","data","textContent","current","Math","round","temperature_2m","src","weatherIcon","weather_code","apparent_temperature","current_units","relative_humidity_2m","wind_speed_10m","precipitation","forecastContainer","innerHTML","i","daily","tempMax","temperature_2m_max","tempMin","temperature_2m_min","icon","daily_units","hourlyContainer","now","startIndex","hourly","findIndex","hourlyTemp","hourlyIcon","hourlyTime","daysInput","querySelectorAll","today","getDay","forEach","Number","value","label","closest","buttonDropdownDays","trim","checked","dropdownDays","getNextDateForWeekday","selectedDay","setHours","diff","targetDate","setDate","getDate","findStartIndexForSelectedDay","getTime","refreshHourlyForecast","console","warn","getSelectedDay","inputDaySelection","addEventListener","e","target","weatherCode","includes","style","display","dropdownUnit","buttonDropdownUnit","API_URL","window","location","hostname","fetchWeather","_ref","fetch","encodeURIComponent","then","res","json","_data$","lat","lon","locationName","display_name","split","locationResult","url","buildMeteoUrl","alert","currentCity","currentUnit","refreshWeather","weatherUnits","temperature","wind","tempRadio","windRadio","precipRadio","meteoUrlBase","params","push","join","meteoData","err","error","handleRadioGroup","selector","unitType"],"mappings":"AAAA,aAMA,IAAIA,YAAc,KACZC,MAAQC,SAASC,eAAe,eAChCC,aAAeF,SAASC,eAAe,aACvCE,UAAYH,SAASI,cAAc,gBAGzC,SAASC,UAAUC,GAAuB,IAGpCC,EAaJ,OAVEA,EADa,aALcC,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAG,QAMpB,CAAEG,QAAS,SAEX,CACRA,QAAS,OACTC,KAAM,UACNC,MAAO,QACPC,IAAK,WAXO,IAAIC,KAAKT,GAeVU,mBAAmB,QAAST,EAC7C,CAEA,SAASU,WAAWC,GAClB,IACIC,EADS,IAAIJ,KAAKG,GACLE,WAEXC,EAAOF,GAAS,GAAK,MAAQ,MAKnC,MAAA,GAAAG,OAFAH,EAAkB,KADlBA,GAAgB,IACM,GAAKA,GAEZG,OAAGD,EACpB,CAGA,SAASE,gBAAgBC,GAEvBxB,SAASC,eAAe,QAAQwB,YAAcpB,UAAUmB,EAAKE,QAAQR,MAErElB,SAASC,eAAe,eAAewB,YACrCE,KAAKC,MAAMJ,EAAKE,QAAQG,gBAAkB,IAE5C7B,SAASC,eAAe,qBAAqB6B,IAAMC,YAAYP,EAAKE,QAAQM,cAE5EhC,SAASC,eAAe,qBAAqBwB,YAC3CE,KAAKC,MAAMJ,EAAKE,QAAQO,sBAAwBT,EAAKU,cAAcD,qBAErEjC,SAASC,eAAe,YAAYwB,YAClCD,EAAKE,QAAQS,qBAAuB,IAEtCnC,SAASC,eAAe,QAAQwB,YAC9BE,KAAKC,MAAMJ,EAAKE,QAAQU,gBAAkBZ,EAAKU,cAAcE,eAE/DpC,SAASC,eAAe,iBAAiBwB,YACvCD,EAAKE,QAAQW,cAAgBb,EAAKU,cAAcG,cAGlD,IAAMC,EAAoBtC,SAASI,cAAc,uBACjDkC,EAAkBC,UAAY,GAE9B,IAAK,IAAIC,EAAI,EAAGA,EAAI,EAAGA,IAAK,CAC1B,IAAM1B,EAAMU,EAAKiB,MAAMvB,KAAKsB,GACtBE,EAAUlB,EAAKiB,MAAME,mBAAmBH,GACxCI,EAAUpB,EAAKiB,MAAMI,mBAAmBL,GAExCM,EAAOf,YAAYP,EAAKiB,MAAMT,aAAaQ,IAEjDF,EAAkBC,WAAS,uFAAAjB,OAGnBjB,UAAUS,EAAK,WAAU,uCAAAQ,OAEjBwB,EAAI,kKAAAxB,OAGVK,KAAKC,MAAMc,GAAQ,SAAApB,OAAQE,EAAKuB,YAAYJ,mBAAkB,wGAAArB,OAG9DK,KAAKC,MAAMgB,GAAQ,SAAAtB,OAAQE,EAAKuB,YAAYJ,mBAAkB,6DAK1E,CAGA,IAAMK,EAAkBhD,SAASI,cAAc,qBAC/C4C,EAAgBT,UAAY,GAQ5B,IALA,IAAMU,EAAM,IAAIlC,KACVmC,EAAa1B,EAAK2B,OAAOjC,KAAKkC,UAAU,SAAAlC,GAC5C,OAAO,IAAIH,KAAKG,IAAS+B,CAC3B,GAEST,EAAIU,EAAYV,EAAIU,EAAa,EAAGV,IAAK,CAChD,IAAMa,EAAa7B,EAAK2B,OAAOtB,eAAeW,GACxCc,EAAavB,YAAYP,EAAK2B,OAAOnB,aAAaQ,IAClDe,EAAatC,WAAWO,EAAK2B,OAAOjC,KAAKsB,IAE/CQ,EAAgBT,WAAS,4LAAAjB,OAGPgC,EAAU,4EAAAhC,OACOiC,EAAU,mEAAAjC,OAGV+B,EAAU,uCAG/C,CAGA,IAAMG,EAAYxD,SAASyD,iBAAiB,6BACtCC,EAAQT,EAAIU,SAElBH,EAAUI,QAAQ,SAAA7D,GAChB,GAAI2D,IAAUG,OAAO9D,EAAM+D,OAAQ,CACjC,IAAMC,EAAQhE,EAAMiE,QAAQ,SAC5BC,mBAAmB1B,UAAS,GAAAjB,OAAMyC,EAAMtC,YAAYyC,OAAM,gFAC1DnE,EAAMoE,SAAU,CAClB,CACF,EACF,CAGA,IAAMC,aAAepE,SAASI,cAAc,kBACtC6D,mBAAqBjE,SAASI,cAAc,yBAOlD,SAASiE,sBAAsBC,GAC7B,IAAMZ,EAAQ,IAAI3C,KAClB2C,EAAMa,SAAS,EAAG,EAAG,EAAG,GAExB,IAGIC,EAHkBF,EAAc,EAEnBZ,EAAMC,SAGnBa,EAAO,IACTA,GAAQ,GAGV,IAAMC,EAAa,IAAI1D,KAAK2C,GAI5B,OAHAe,EAAWC,QAAQhB,EAAMiB,UAAYH,GACrCC,EAAWF,SAAS,EAAG,EAAG,EAAG,GAEtBE,CACT,CAEA,SAASG,6BAA6BN,GACpC,IAAMG,EAAaJ,sBAAsBC,GAEzC,OAAOxE,YAAYqD,OAAOjC,KAAKkC,UAAU,SAAAlC,GACvC,OAAO,IAAIH,KAAKG,GAAM2D,YAAcJ,EAAWI,SACjD,EACF,CAEA,SAASC,sBAAsBR,GAC7B,IAAMtB,EAAkBhD,SAASI,cAAc,qBAC/C4C,EAAgBT,UAAY,GAE5B,IAAMW,EAAa0B,6BAA6Bf,OAAOS,IAEvD,IAAoB,IAAhBpB,EAKJ,IAAK,IAAIV,EAAIU,EAAYV,EAAIU,EAAa,EAAGV,IAAK,CAChD,IAAMa,EAAavD,YAAYqD,OAAOtB,eAAeW,GAC/Cc,EAAavB,YAAYjC,YAAYqD,OAAOnB,aAAaQ,IACzDe,EAAatC,WAAWnB,YAAYqD,OAAOjC,KAAKsB,IAEtDQ,EAAgBT,WAAS,4LAAAjB,OAGPgC,EAAU,4EAAAhC,OACOiC,EAAU,+DAAAjC,OAEV+B,EAAU,uCAG/C,MAlBE0B,QAAQC,KAAK,qCAmBjB,CAEA,SAASC,eAAenB,GACtB,IAAMxD,EAAO,IAAIS,KAGjB,OAFAT,EAAKiE,SAAS,EAAG,EAAG,EAAG,GACvBjE,EAAKoE,QAAQpE,EAAKqE,UAAYb,GACvBxD,CACT,CAEA,SAAS4E,oBACYlF,SAASyD,iBAAiB,6BAElCG,QAAQ,SAAA7D,GACjBA,EAAMoF,iBAAiB,SAAU,SAACC,GAC5BA,EAAEC,OAAOlB,SACXW,sBAAsBM,EAAEC,OAAOvB,MAEnC,EACF,EACF,CAKA,SAAS/B,YAAYuD,GACnB,OAAoB,IAAhBA,EACK,kCAEW,IAAhBA,EACK,0CAEW,IAAhBA,GAAqC,IAAhBA,EAChB,qCAEW,KAAhBA,GAAuC,KAAjBA,EACjB,gCAEL,CAAC,GAAI,GAAI,IAAIC,SAASD,GACjB,oCAEL,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,IAAIC,SAASD,GAC7B,iCAEW,KAAhBA,EACK,iCAEW,KAAhBA,EACK,kCAEF,iCACT,CA7GArB,mBAAmBkB,iBAAiB,QAAS,WAC3Cf,aAAaoB,MAAMC,QACc,UAA/BrB,aAAaoB,MAAMC,QAAsB,OAAS,OACtD,GA6EAP,oBAgCA,IAAMQ,aAAe1F,SAASI,cAAc,mBACtCuF,mBAAqB3F,SAASI,cAAc,0BAElDuF,mBAAmBR,iBAAiB,QAAS,WAC3CO,aAAaF,MAAMC,QACc,UAA/BC,aAAaF,MAAMC,QAAsB,OAAS,OACtD,GAEA,IAAMG,QACyB,cAA7BC,OAAOC,SAASC,SACZ,wBACA,wDAGN,SAASC,aAAYC,GAAY,IAATnC,EAAKmC,EAALnC,MACtB,OACEoC,MAAK,GAAA5E,OAAIsE,QAAO,kBAAAtE,OAAiB6E,mBAAmBrC,KACnDsC,KAAK,SAAAC,GAAG,OAAIA,EAAIC,MAAM,GACtBF,KAAK,SAAA5E,GACJ,GAAKA,EAAKf,OAAV,CAMA,IAAA8F,EAAmC/E,EAAK,GAAhCgF,EAAGD,EAAHC,IAAKC,EAAGF,EAAHE,IAGPC,EAHwBH,EAAZI,aAGgBC,MAAM,KAElCC,EAAiBH,EAAa,GAAGxC,OAAS,KAAOwC,EAAaA,EAAajG,OAAS,GAAGyD,OAE7FlE,SAASC,eAAe,YAAYwB,YAAcoF,EAGlD,IAAMC,EAAMC,cAAcP,EAAKC,GAC/B,OAAOP,MAAMY,EAbb,CAFEE,MAAM,0BAgBV,EAEJ,CAGA,IAAIC,YAAc,SACdC,YAAc,SAGlBhH,aAAaiF,iBAAiB,QAAS,WACrC,IAAMrB,EAAQ/D,MAAM+D,MACpBmD,YAAcnD,EAEdqD,gBACF,GAEAhH,UAAUgF,iBAAiB,QAAS,WAElC+B,YAA8B,WAAhBA,YAA2B,WAAa,SAEzB/G,UAAUoC,UAAvB,aAAhB2E,YAAmD,mBAA2C,qBAE1E,WAAhBA,aACFE,aAAaC,YAAc,UAC3BD,aAAaE,KAAO,MACpBF,aAAa/E,cAAgB,MACJ,aAAhB6E,cACTE,aAAaC,YAAc,aAC3BD,aAAaE,KAAO,MACpBF,aAAa/E,cAAgB,MAG/B,IAAMkF,EAAYvH,SAASI,cAAa,yCAAAkB,OAA0C8F,aAAaC,YAAW,OACpGG,EAAYxH,SAASI,cAAa,kCAAAkB,OAAmC8F,aAAaE,KAAI,OACtFG,EAAczH,SAASI,cAAa,2CAAAkB,OAA4C8F,aAAa/E,cAAa,OAE5GkF,IAAWA,EAAUpD,SAAU,GAC/BqD,IAAWA,EAAUrD,SAAU,GAC/BsD,IAAaA,EAAYtD,SAAU,GAEvCgD,gBACF,GAIA,IAAMC,aAAe,CACnBC,YAAa,UACbC,KAAM,MACNjF,cAAe,MAGjB,SAAS0E,cAAcP,EAAKC,GAC1B,IAAMiB,EAAY,mDAAApG,OAAsDkF,EAAG,eAAAlF,OAAcmF,EAAG,yNAEtFkB,EAAS,GAcf,MAZiC,eAA7BP,aAAaC,aACfM,EAAOC,KAAK,+BAGY,QAAtBR,aAAaE,MACfK,EAAOC,KAAK,uBAGqB,OAA/BR,aAAa/E,eACfsF,EAAOC,KAAK,2BAGPD,EAAOlH,OAAM,GAAAa,OACboG,EAAY,KAAApG,OAAIqG,EAAOE,KAAK,MACjCH,CACJ,CAEA,SAASP,iBACPnB,aAAa,CAAElC,MAAOmD,cACrBb,KAAK,SAAAC,GAAG,OAAIA,EAAIC,MAAM,GACtBF,KAAK,SAAA0B,GACJhI,YAAcgI,EACdvG,gBAAgBuG,EAClB,GAAE,MACK,SAAAC,GAAG,OAAIhD,QAAQiD,MAAMD,EAAI,EAClC,CAEA,SAASE,iBAAiBC,EAAUC,GACnBnI,SAASyD,iBAAiByE,GAElCtE,QAAQ,SAAA7D,GACbA,EAAMoF,iBAAiB,SAAU,SAACC,GAC5BA,EAAEC,OAAOlB,UACXiD,aAAae,GAAY/C,EAAEC,OAAOvB,MAClCqD,iBAEJ,EACF,EACF,CAEAc,iBAAiB,iCAAkC,eAEnDA,iBAAiB,0BAA2B,QAE5CA,iBAAiB,mCAAoC","file":"script.js","sourcesContent":["// Exemple d'une réponse\n// https://api.open-meteo.com/v1/forecast?latitude=52.52&longitude=13.41&hourly=temperature_2m&models=gfs_seamless\n\n// Récupérer la valeur de l'input de search\n// Au moment où l'utilisateur clique sur search, afficher la ville correspondante\n\nlet weatherData = null;\nconst input = document.getElementById(\"searchInput\");\nconst searchButton = document.getElementById(\"searchBtn\");\nconst btnMetric = document.querySelector('.btn--metric');\n\n// Formatage de la date iso récupérée de l'API \nfunction isoToDate(date, format = \"full\") {\n  const dateObj = new Date(date);\n\n  let options;\n\n  if (format === \"weekday\") {\n    options = { weekday: \"short\" }\n  } else {\n    options = {\n      weekday: \"long\",\n      year: \"numeric\",\n      month: \"short\",\n      day: \"numeric\"\n    }\n  } \n\n  return dateObj.toLocaleDateString(\"en-US\", options);\n}\n\nfunction formatHour(time) {\n  const date = new Date(time);\n  let hours = date.getHours(); // 0 → 23\n\n  const ampm = hours >= 12 ? \" PM\" : \" AM\";\n\n  hours = hours % 12;\n  hours = hours === 0 ? 12 : hours;\n\n  return `${hours}${ampm}`;\n}\n\n// Update HTML des données récupérées \nfunction updateWeatherUI(data) {\n  // Update current forecast\n  document.getElementById(\"time\").textContent = isoToDate(data.current.time);\n\n  document.getElementById(\"temperature\").textContent =\n    Math.round(data.current.temperature_2m) + \"°\";\n\n  document.getElementById(\"weather-code-icon\").src = weatherIcon(data.current.weather_code);\n\n  document.getElementById(\"temperature-feels\").textContent =\n    Math.round(data.current.apparent_temperature) + data.current_units.apparent_temperature;\n\n  document.getElementById(\"humidity\").textContent =\n    data.current.relative_humidity_2m + \"%\";\n\n  document.getElementById(\"wind\").textContent =\n    Math.round(data.current.wind_speed_10m) + data.current_units.wind_speed_10m;\n\n  document.getElementById(\"precipitation\").textContent =\n    data.current.precipitation + data.current_units.precipitation;\n\n  // Update daily forecast\n  const forecastContainer = document.querySelector('.forecast_container');\n  forecastContainer.innerHTML = \"\";\n\n  for (let i = 0; i < 7; i++) {\n    const day = data.daily.time[i];\n    const tempMax = data.daily.temperature_2m_max[i];\n    const tempMin = data.daily.temperature_2m_min[i];\n\n    const icon = weatherIcon(data.daily.weather_code[i]);\n\n    forecastContainer.innerHTML += `\n      <div class=\"card py-4 px-2.5\">\n        <h3 class=\"card__title\">\n          ${isoToDate(day, \"weekday\")}\n        </h3>\n        <img src=\"${icon}\" alt=\"Weather Icon\" class=\"card__icon\">\n        <div class=\"card__temperatures flex justify-between\">\n          <p class=\"card__temperature\">\n            ${Math.round(tempMax)}<sup>${data.daily_units.temperature_2m_max}</sup>\n          </p>\n          <p class=\"card__temperature card__temperature--low\">\n            ${Math.round(tempMin)}<sup>${data.daily_units.temperature_2m_max}</sup>\n          </p>\n        </div>\n      </div>\n    `;\n  }\n\n  // Update hourly forecast\n  const hourlyContainer = document.querySelector('.hourly_container');\n  hourlyContainer.innerHTML = \"\";\n\n  // Trouver l'index de l'heure actuelle\n  const now = new Date();\n  const startIndex = data.hourly.time.findIndex(time => {\n    return new Date(time) >= now;\n  });\n\n  for (let i = startIndex; i < startIndex + 8; i++) {\n    const hourlyTemp = data.hourly.temperature_2m[i];\n    const hourlyIcon = weatherIcon(data.hourly.weather_code[i]);\n    const hourlyTime = formatHour(data.hourly.time[i]);\n\n    hourlyContainer.innerHTML += `\n      <div class=\"hourly_container card card--light flex flex-row items-center justify-between mt-4 py-2 px-3\">\n        <div class=\"flex flex-row items-center\">\n          <img src=\"${hourlyIcon}\" alt=\"\" class=\"card__icon w-10\">\n          <p class=\"card__hour ml-2\">${hourlyTime}</p>\n        </div>\n  \n        <p class=\"card__temperature\">${hourlyTemp}<sup>°</sup></p>\n      </div>\n    `;\n  };\n\n  // Update current day in day selection dropdown\n  const daysInput = document.querySelectorAll('input[name=\"select-days\"]');\n  const today = now.getDay();\n\n  daysInput.forEach(input => {\n    if (today === Number(input.value)) {\n      const label = input.closest('label');\n      buttonDropdownDays.innerHTML = `${label.textContent.trim()} <img class=\"dropdown-icon w-3.5\" src=\"./assets/images/icon-dropdown.svg\" />`;\n      input.checked = true;\n    }\n  })\n}\n\n// Handle day selection for hourly forecast\nconst dropdownDays = document.querySelector('.dropdown-days');\nconst buttonDropdownDays = document.querySelector('.dropdown-button-days');\n\nbuttonDropdownDays.addEventListener('click', () => {\n  dropdownDays.style.display =\n    dropdownDays.style.display === \"block\" ? \"none\" : \"block\";\n});\n\nfunction getNextDateForWeekday(selectedDay) {\n  const today = new Date();\n  today.setHours(0, 0, 0, 0);\n\n  const jsSelectedDay = selectedDay % 7;\n\n  const todayDay = today.getDay();\n  let diff = jsSelectedDay - todayDay;\n\n  if (diff < 0) {\n    diff += 7;\n  }\n\n  const targetDate = new Date(today);\n  targetDate.setDate(today.getDate() + diff);\n  targetDate.setHours(9, 0, 0, 0);\n\n  return targetDate;\n}\n\nfunction findStartIndexForSelectedDay(selectedDay) {\n  const targetDate = getNextDateForWeekday(selectedDay);\n\n  return weatherData.hourly.time.findIndex(time => {\n    return new Date(time).getTime() === targetDate.getTime();\n  });\n}\n\nfunction refreshHourlyForecast(selectedDay) {\n  const hourlyContainer = document.querySelector('.hourly_container');\n  hourlyContainer.innerHTML = '';\n\n  const startIndex = findStartIndexForSelectedDay(Number(selectedDay));\n\n  if (startIndex === -1) {\n    console.warn('Aucune donnée trouvée pour ce jour');\n    return;\n  }\n\n  for (let i = startIndex; i < startIndex + 9; i++) {\n    const hourlyTemp = weatherData.hourly.temperature_2m[i];\n    const hourlyIcon = weatherIcon(weatherData.hourly.weather_code[i]);\n    const hourlyTime = formatHour(weatherData.hourly.time[i]);\n\n    hourlyContainer.innerHTML += `\n      <div class=\"hourly_container card card--light flex flex-row items-center justify-between mt-4 py-2 px-3\">\n        <div class=\"flex flex-row items-center\">\n          <img src=\"${hourlyIcon}\" alt=\"\" class=\"card__icon w-10\">\n          <p class=\"card__hour ml-2\">${hourlyTime}</p>\n        </div>\n        <p class=\"card__temperature\">${hourlyTemp}<sup>°</sup></p>\n      </div>\n    `;\n  }\n}\n\nfunction getSelectedDay(value) {\n  const date = new Date();\n  date.setHours(9, 0, 0, 0);\n  date.setDate(date.getDate() + value);\n  return date;\n}\n\nfunction inputDaySelection() {\n  const inputsDays = document.querySelectorAll('input[name=\"select-days\"]');\n\n  inputsDays.forEach(input => {\n    input.addEventListener('change', (e) => {\n      if (e.target.checked) {\n        refreshHourlyForecast(e.target.value);\n      }\n    });\n  });\n}\n\ninputDaySelection();\n\n// Update weather icon en fonction du weather code\nfunction weatherIcon(weatherCode) {\n  if (weatherCode === 0) {\n    return \"./assets/images/icon-sunny.webp\";\n  };\n  if (weatherCode === 2) {\n    return \"./assets/images/icon-partly-cloudy.webp\";\n  } \n  if (weatherCode === 1 || weatherCode === 3) {\n    return \"./assets/images/icon-overcast.webp\";\n  };\n  if (weatherCode === 45 || weatherCode ===  48) {\n    return \"./assets/images/icon-fog.webp\";\n  }\n  if ([51, 53, 55].includes(weatherCode)) {\n    return \"./assets/images/icon-drizzle.webp\";\n  }\n  if ([61, 63, 65, 80, 81, 82].includes(weatherCode)) {\n    return \"./assets/images/icon-rain.webp\";\n  }\n  if (weatherCode === 73) {\n    return \"./assets/images/icon-snow.webp\";\n  }\n  if (weatherCode === 95) {\n    return \"./assets/images/icon-storm.webp\";\n  }\n  return \"./assets/images/icon-sunny.webp\";\n}\n\n// Dropdown display toggle\nconst dropdownUnit = document.querySelector('.dropdown-units');\nconst buttonDropdownUnit = document.querySelector('.dropdown-button-units');\n\nbuttonDropdownUnit.addEventListener('click', () => {\n  dropdownUnit.style.display =\n    dropdownUnit.style.display === \"block\" ? \"none\" : \"block\";\n});\n\nconst API_URL =\n  window.location.hostname === \"localhost\"\n    ? \"http://localhost:3002\"\n    : \"https://weatherapp-frontendmentor-server.onrender.com\";\n\n// Fetch weather depending on city (value) and unit\nfunction fetchWeather({ value }) {\n  return(\n    fetch(`${API_URL}/api/search?q=${encodeURIComponent(value)}`)\n    .then(res => res.json())\n    .then(data => {\n      if (!data.length) {\n        // TO DO: ERROR PAGE\n        alert('Aucun résultat trouvé !');\n        return;\n      }\n\n      const { lat, lon, display_name } = data[0];\n\n      // Transformation du display name pour n'afficher que la ville et le pays\n      const locationName = display_name.split(\",\");\n\n      const locationResult = locationName[0].trim() + \", \" + locationName[locationName.length - 1].trim();\n\n      document.getElementById(\"location\").textContent = locationResult;\n\n      // Deuxième fetch pour aller récupérer les données de l'API Open Meteo\n      const url = buildMeteoUrl(lat, lon);\n      return fetch(url);\n    })\n  );\n}\n\n// Memorize city and metrics\nlet currentCity = 'Berlin';\nlet currentUnit = 'metric';\n\n// Handle different buttons listeners\nsearchButton.addEventListener('click', () => {\n  const value = input.value;\n  currentCity = value;\n\n  refreshWeather();\n});\n\nbtnMetric.addEventListener('click', () => {\n  // Change metric\n  currentUnit = currentUnit === 'metric' ? 'imperial' : 'metric';\n\n  currentUnit === 'imperial' ? btnMetric.innerHTML = 'Switch to Metric' : btnMetric.innerHTML = 'Switch to Imperial';\n\n  if (currentUnit === 'metric') {\n    weatherUnits.temperature = 'celsius';\n    weatherUnits.wind = 'kmh';\n    weatherUnits.precipitation = 'mm';\n  } else if (currentUnit === 'imperial') {\n    weatherUnits.temperature = 'fahrenheit';\n    weatherUnits.wind = 'mph';\n    weatherUnits.precipitation = 'in';\n  }\n\n  const tempRadio = document.querySelector(`input[name=\"temperature-unit\"][value=\"${weatherUnits.temperature}\"]`);\n  const windRadio = document.querySelector(`input[name=\"wind-unit\"][value=\"${weatherUnits.wind}\"]`);\n  const precipRadio = document.querySelector(`input[name=\"precipitation-unit\"][value=\"${weatherUnits.precipitation}\"]`);\n\n  if (tempRadio) tempRadio.checked = true;\n  if (windRadio) windRadio.checked = true;\n  if (precipRadio) precipRadio.checked = true;\n\n  refreshWeather();\n});\n\n// Make the individual unit selection\n// Global state\nconst weatherUnits = {\n  temperature: 'celsius',\n  wind: 'kmh',\n  precipitation: 'mm'\n};\n\nfunction buildMeteoUrl(lat, lon) {\n  const meteoUrlBase = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&daily=weather_code,temperature_2m_max,temperature_2m_min&current=temperature_2m,relative_humidity_2m,precipitation,wind_speed_10m,apparent_temperature,weather_code&hourly=temperature_2m,weather_code&timezone=auto`;\n\n  const params = [];\n\n  if (weatherUnits.temperature === 'fahrenheit') {\n    params.push('temperature_unit=fahrenheit');\n  }\n\n  if (weatherUnits.wind === 'mph') {\n    params.push('wind_speed_unit=mph');\n  }\n\n  if (weatherUnits.precipitation === 'in') {\n    params.push('precipitation_unit=inch');\n  }\n\n  return params.length\n    ? `${meteoUrlBase}&${params.join('&')}`\n  : meteoUrlBase;\n} \n\nfunction refreshWeather() {\n  fetchWeather({ value: currentCity })\n  .then(res => res.json())\n  .then(meteoData => {\n    weatherData = meteoData;\n    updateWeatherUI(meteoData);\n  })\n  .catch(err => console.error(err));\n}\n\nfunction handleRadioGroup(selector, unitType) {\n  const inputs = document.querySelectorAll(selector);\n\n  inputs.forEach(input => {\n    input.addEventListener('change', (e) => {\n      if (e.target.checked) {\n        weatherUnits[unitType] = e.target.value;\n        refreshWeather();\n      }\n    })\n  })\n};\n\nhandleRadioGroup('input[name=\"temperature-unit\"]', 'temperature');\n\nhandleRadioGroup('input[name=\"wind-unit\"]', 'wind');\n\nhandleRadioGroup('input[name=\"precipitation-unit\"]', 'precipitation');"]}