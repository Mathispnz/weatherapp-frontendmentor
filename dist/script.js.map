{"version":3,"sources":["script.js"],"names":["input","document","getElementById","button","isoToDate","date","options","arguments","length","undefined","weekday","year","month","day","Date","toLocaleDateString","formatHour","time","hours","getHours","ampm","concat","updateWeatherUI","data","textContent","current","Math","round","temperature_2m","src","weatherIcon","weather_code","apparent_temperature","relative_humidity_2m","wind_speed_10m","precipitation","forecastContainer","querySelector","innerHTML","i","daily","tempMax","temperature_2m_max","tempMin","temperature_2m_min","icon","hourlyContainer","now","startIndex","hourly","findIndex","hourlyTemp","hourlyIcon","hourlyTime","weatherCode","addEventListener","value","console","log","fetch","encodeURIComponent","then","res","json","_data$","lat","lon","locationName","display_name","split","locationResult","trim","meteoUrl","alert","meteoData","err","error"],"mappings":"AAAA,aAMA,IAAMA,MAAQC,SAASC,eAAe,eAChCC,OAASF,SAASC,eAAe,aAsCvC,SAASE,UAAUC,GAAuB,IAGpCC,EAaJ,OAVEA,EADa,aALcC,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAG,QAMpB,CAAEG,QAAS,SAEX,CACRA,QAAS,OACTC,KAAM,UACNC,MAAO,QACPC,IAAK,WAXO,IAAIC,KAAKT,GAeVU,mBAAmB,QAAST,EAC7C,CAEA,SAASU,WAAWC,GAClB,IACIC,EADS,IAAIJ,KAAKG,GACLE,WAEXC,EAAOF,GAAS,GAAK,MAAQ,MAKnC,MAAA,GAAAG,OAFAH,EAAkB,KADlBA,GAAgB,IACM,GAAKA,GAEZG,OAAGD,EACpB,CAGA,SAASE,gBAAgBC,GAEvBtB,SAASC,eAAe,QAAQsB,YAAcpB,UAAUmB,EAAKE,QAAQR,MAErEhB,SAASC,eAAe,eAAesB,YACrCE,KAAKC,MAAMJ,EAAKE,QAAQG,gBAAkB,IAE5C3B,SAASC,eAAe,qBAAqB2B,IAAMC,YAAYP,EAAKE,QAAQM,cAE5E9B,SAASC,eAAe,qBAAqBsB,YAC3CE,KAAKC,MAAMJ,EAAKE,QAAQO,sBAAwB,IAElD/B,SAASC,eAAe,YAAYsB,YAClCD,EAAKE,QAAQQ,qBAAuB,IAEtChC,SAASC,eAAe,QAAQsB,YAC9BE,KAAKC,MAAMJ,EAAKE,QAAQS,gBAAkB,OAE5CjC,SAASC,eAAe,iBAAiBsB,YACvCD,EAAKE,QAAQU,cAAgB,KAG/B,IAAMC,EAAoBnC,SAASoC,cAAc,uBACjDD,EAAkBE,UAAY,GAE9B,IAAK,IAAIC,EAAI,EAAGA,EAAI,EAAGA,IAAK,CAC1B,IAAM1B,EAAMU,EAAKiB,MAAMvB,KAAKsB,GACtBE,EAAUlB,EAAKiB,MAAME,mBAAmBH,GACxCI,EAAUpB,EAAKiB,MAAMI,mBAAmBL,GAExCM,EAAOf,YAAYP,EAAKiB,MAAMT,aAAaQ,IAEjDH,EAAkBE,WAAS,uFAAAjB,OAGnBjB,UAAUS,EAAK,WAAU,uCAAAQ,OAEjBwB,EAAI,kKAAAxB,OAGVK,KAAKC,MAAMc,GAAQ,8GAAApB,OAGnBK,KAAKC,MAAMgB,GAAQ,mEAK/B,CAGA,IAAMG,EAAkB7C,SAASoC,cAAc,qBAC/CS,EAAgBR,UAAY,GAQ5B,IALA,IAAMS,EAAM,IAAIjC,KACVkC,EAAazB,EAAK0B,OAAOhC,KAAKiC,UAAU,SAAAjC,GAC5C,OAAO,IAAIH,KAAKG,IAAS8B,CAC3B,GAESR,EAAIS,EAAYT,EAAIS,EAAa,EAAGT,IAAK,CAChD,IAAMY,EAAa5B,EAAK0B,OAAOrB,eAAeW,GACxCa,EAAatB,YAAYP,EAAK0B,OAAOlB,aAAaQ,IAClDc,EAAarC,WAAWO,EAAK0B,OAAOhC,KAAKsB,IAE/CO,EAAgBR,WAAS,4LAAAjB,OAGP+B,EAAU,4EAAA/B,OACOgC,EAAU,mEAAAhC,OAGV8B,EAAU,uCAG/C,CACF,CAGA,SAASrB,YAAYwB,GACnB,OAAoB,IAAhBA,EACK,kCAEW,IAAhBA,EACK,0CAEW,IAAhBA,GAAqC,IAAhBA,EAChB,qCAEW,KAAhBA,GAAuC,KAAjBA,EACjB,gCAEW,KAAhBA,EACK,oCAEW,KAAhBA,EACK,iCAEW,KAAhBA,EACK,iCAEW,KAAhBA,EACK,kCAEF,iCACT,CA7KAnD,OAAOoD,iBAAiB,QAAS,WAC/B,IAAMC,EAAQxD,MAAMwD,MACpBC,QAAQC,IAAIF,GAGZG,MAAK,sCAAAtC,OAAuCuC,mBAAmBJ,KAC5DK,KAAK,SAAAC,GAAG,OAAIA,EAAIC,MAAM,GACtBF,KAAK,SAAAtC,GACJ,GAAKA,EAAKf,OAAV,CAKA,IAAAwD,EAAmCzC,EAAK,GAAhC0C,EAAGD,EAAHC,IAAKC,EAAGF,EAAHE,IAGPC,EAHwBH,EAAZI,aAGgBC,MAAM,KAElCC,EAAiBH,EAAa,GAAGI,OAAS,KAAOJ,EAAaA,EAAa3D,OAAS,GAAG+D,OAE7FtE,SAASC,eAAe,YAAYsB,YAAc8C,EAGlD,IAAME,EAAQ,mDAAAnD,OAAsD4C,EAAG,eAAA5C,OAAc6C,EAAG,yNAExF,OAAOP,MAAMa,EAdb,CAFEC,MAAM,wBAiBV,GACCZ,KAAK,SAAAC,GAAG,OAAIA,EAAIC,MAAM,GACtBF,KAAK,SAAAa,GACJjB,QAAQC,IAAIgB,GACZpD,gBAAgBoD,EAClB,GAAE,MACK,SAAAC,GAAG,OAAIlB,QAAQmB,MAAMD,EAAI,EACpC","file":"script.js","sourcesContent":["// Exemple d'une réponse\n// https://api.open-meteo.com/v1/forecast?latitude=52.52&longitude=13.41&hourly=temperature_2m&models=gfs_seamless\n\n// Récupérer la valeur de l'input de search\n// Au moment où l'utilisateur clique sur search, afficher la ville correspondante\n\nconst input = document.getElementById(\"searchInput\");\nconst button = document.getElementById(\"searchBtn\");\n\nbutton.addEventListener(\"click\", () => {\n  const value = input.value;\n  console.log(value);\n\n  // Fetch du backend de l'API Nominatim pour récupérer les données géoloc via la valeur de l'input\n  fetch(`http://localhost:3002/api/search?q=${encodeURIComponent(value)}`)\n    .then(res => res.json())\n    .then(data => {\n      if (!data.length) {\n        alert(\"Aucun résultat trouvé\");\n        return;\n      }\n\n      const { lat, lon, display_name } = data[0];\n\n      // Transformation du display name pour n'afficher que la ville et le pays\n      const locationName = display_name.split(\",\");\n\n      const locationResult = locationName[0].trim() + \", \" + locationName[locationName.length - 1].trim();\n\n      document.getElementById(\"location\").textContent = locationResult;\n\n      // Deuxième fetch pour aller récupérer les données de l'API Open Meteo\n      const meteoUrl = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&daily=weather_code,temperature_2m_max,temperature_2m_min&current=temperature_2m,relative_humidity_2m,precipitation,wind_speed_10m,apparent_temperature,weather_code&hourly=temperature_2m,weather_code&timezone=auto`;\n\n      return fetch(meteoUrl);\n    })\n    .then(res => res.json())\n    .then(meteoData => {\n      console.log(meteoData);\n      updateWeatherUI(meteoData);\n    })\n    .catch(err => console.error(err));\n});\n\n// Formatage de la date iso récupérée de l'API \nfunction isoToDate(date, format = \"full\") {\n  const dateObj = new Date(date);\n\n  let options;\n\n  if (format === \"weekday\") {\n    options = { weekday: \"short\" }\n  } else {\n    options = {\n      weekday: \"long\",\n      year: \"numeric\",\n      month: \"short\",\n      day: \"numeric\"\n    }\n  } \n\n  return dateObj.toLocaleDateString(\"en-US\", options);\n}\n\nfunction formatHour(time) {\n  const date = new Date(time);\n  let hours = date.getHours(); // 0 → 23\n\n  const ampm = hours >= 12 ? \" PM\" : \" AM\";\n\n  hours = hours % 12;\n  hours = hours === 0 ? 12 : hours;\n\n  return `${hours}${ampm}`;\n}\n\n// Update HTML des données récupérées \nfunction updateWeatherUI(data) {\n  // Update current forecast\n  document.getElementById(\"time\").textContent = isoToDate(data.current.time);\n\n  document.getElementById(\"temperature\").textContent =\n    Math.round(data.current.temperature_2m) + \"°\";\n\n  document.getElementById(\"weather-code-icon\").src = weatherIcon(data.current.weather_code);\n\n  document.getElementById(\"temperature-feels\").textContent =\n    Math.round(data.current.apparent_temperature) + \"°\";\n\n  document.getElementById(\"humidity\").textContent =\n    data.current.relative_humidity_2m + \"%\";\n\n  document.getElementById(\"wind\").textContent =\n    Math.round(data.current.wind_speed_10m) + \"km/h\";\n\n  document.getElementById(\"precipitation\").textContent =\n    data.current.precipitation + \"mm\";\n\n  // Update daily forecast\n  const forecastContainer = document.querySelector('.forecast_container');\n  forecastContainer.innerHTML = \"\";\n\n  for (let i = 0; i < 7; i++) {\n    const day = data.daily.time[i];\n    const tempMax = data.daily.temperature_2m_max[i];\n    const tempMin = data.daily.temperature_2m_min[i];\n\n    const icon = weatherIcon(data.daily.weather_code[i]);\n\n    forecastContainer.innerHTML += `\n      <div class=\"card py-4 px-2.5\">\n        <h3 class=\"card__title\">\n          ${isoToDate(day, \"weekday\")}\n        </h3>\n        <img src=\"${icon}\" alt=\"Weather Icon\" class=\"card__icon\">\n        <div class=\"card__temperatures flex justify-between\">\n          <p class=\"card__temperature\">\n            ${Math.round(tempMax)}<sup>°</sup>\n          </p>\n          <p class=\"card__temperature card__temperature--low\">\n            ${Math.round(tempMin)}<sup>°</sup>\n          </p>\n        </div>\n      </div>\n    `;\n  }\n\n  // Update hourly forecast\n  const hourlyContainer = document.querySelector('.hourly_container');\n  hourlyContainer.innerHTML = \"\";\n\n  // Trouver l'index de l'heure actuelle\n  const now = new Date();\n  const startIndex = data.hourly.time.findIndex(time => {\n    return new Date(time) >= now;\n  });\n\n  for (let i = startIndex; i < startIndex + 8; i++) {\n    const hourlyTemp = data.hourly.temperature_2m[i];\n    const hourlyIcon = weatherIcon(data.hourly.weather_code[i]);\n    const hourlyTime = formatHour(data.hourly.time[i]);\n\n    hourlyContainer.innerHTML += `\n      <div class=\"hourly_container card card--light flex flex-row items-center justify-between mt-4 py-2 px-3\">\n        <div class=\"flex flex-row items-center\">\n          <img src=\"${hourlyIcon}\" alt=\"\" class=\"card__icon w-10\">\n          <p class=\"card__hour ml-2\">${hourlyTime}</p>\n        </div>\n  \n        <p class=\"card__temperature\">${hourlyTemp}<sup>°</sup></p>\n      </div>\n    `;\n  };\n}\n\n// Update weather icon en fonction du weather code\nfunction weatherIcon(weatherCode) {\n  if (weatherCode === 0) {\n    return \"./assets/images/icon-sunny.webp\";\n  };\n  if (weatherCode === 2) {\n    return \"./assets/images/icon-partly-cloudy.webp\";\n  } \n  if (weatherCode === 1 || weatherCode === 3) {\n    return \"./assets/images/icon-overcast.webp\";\n  };\n  if (weatherCode === 45 || weatherCode ===  48) {\n    return \"./assets/images/icon-fog.webp\";\n  }\n  if (weatherCode === 53) {\n    return \"./assets/images/icon-drizzle.webp\";\n  }\n  if (weatherCode === 63) {\n    return \"./assets/images/icon-rain.webp\";\n  }\n  if (weatherCode === 73) {\n    return \"./assets/images/icon-snow.webp\";\n  }\n  if (weatherCode === 95) {\n    return \"./assets/images/icon-storm.webp\";\n  }\n  return \"./assets/images/icon-sunny.webp\";\n}"]}