{"version":3,"sources":["script.js"],"names":["input","document","getElementById","searchButton","btnMetric","querySelector","isoToDate","date","options","arguments","length","undefined","weekday","year","month","day","Date","toLocaleDateString","formatHour","time","hours","getHours","ampm","concat","updateWeatherUI","data","textContent","current","Math","round","temperature_2m","src","weatherIcon","weather_code","apparent_temperature","current_units","relative_humidity_2m","wind_speed_10m","precipitation","forecastContainer","innerHTML","i","daily","tempMax","temperature_2m_max","tempMin","temperature_2m_min","icon","daily_units","hourlyContainer","now","startIndex","hourly","findIndex","hourlyTemp","hourlyIcon","hourlyTime","weatherCode","dropdown","buttonDropdown","fetchWeather","_ref","value","fetch","encodeURIComponent","then","res","json","_data$","lat","lon","locationName","display_name","split","locationResult","trim","url","buildMeteoUrl","alert","addEventListener","style","display","currentCity","currentUnit","refreshWeather","weatherUnits","temperature","wind","tempRadio","windRadio","precipRadio","checked","meteoUrlBase","params","push","join","meteoData","err","console","error","handleRadioGroup","selector","unitType","querySelectorAll","forEach","e","target"],"mappings":"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","file":"script.js","sourcesContent":["// Exemple d'une réponse\n// https://api.open-meteo.com/v1/forecast?latitude=52.52&longitude=13.41&hourly=temperature_2m&models=gfs_seamless\n\n// Récupérer la valeur de l'input de search\n// Au moment où l'utilisateur clique sur search, afficher la ville correspondante\n\nconst input = document.getElementById(\"searchInput\");\nconst searchButton = document.getElementById(\"searchBtn\");\nconst btnMetric = document.querySelector('.btn--metric');\n\n// Formatage de la date iso récupérée de l'API \nfunction isoToDate(date, format = \"full\") {\n  const dateObj = new Date(date);\n\n  let options;\n\n  if (format === \"weekday\") {\n    options = { weekday: \"short\" }\n  } else {\n    options = {\n      weekday: \"long\",\n      year: \"numeric\",\n      month: \"short\",\n      day: \"numeric\"\n    }\n  } \n\n  return dateObj.toLocaleDateString(\"en-US\", options);\n}\n\nfunction formatHour(time) {\n  const date = new Date(time);\n  let hours = date.getHours(); // 0 → 23\n\n  const ampm = hours >= 12 ? \" PM\" : \" AM\";\n\n  hours = hours % 12;\n  hours = hours === 0 ? 12 : hours;\n\n  return `${hours}${ampm}`;\n}\n\n// Update HTML des données récupérées \nfunction updateWeatherUI(data) {\n  // Update current forecast\n  document.getElementById(\"time\").textContent = isoToDate(data.current.time);\n\n  document.getElementById(\"temperature\").textContent =\n    Math.round(data.current.temperature_2m) + \"°\";\n\n  document.getElementById(\"weather-code-icon\").src = weatherIcon(data.current.weather_code);\n\n  document.getElementById(\"temperature-feels\").textContent =\n    Math.round(data.current.apparent_temperature) + data.current_units.apparent_temperature;\n\n  document.getElementById(\"humidity\").textContent =\n    data.current.relative_humidity_2m + \"%\";\n\n  document.getElementById(\"wind\").textContent =\n    Math.round(data.current.wind_speed_10m) + data.current_units.wind_speed_10m;\n\n  document.getElementById(\"precipitation\").textContent =\n    data.current.precipitation + data.current_units.precipitation;\n\n  // Update daily forecast\n  const forecastContainer = document.querySelector('.forecast_container');\n  forecastContainer.innerHTML = \"\";\n\n  for (let i = 0; i < 7; i++) {\n    const day = data.daily.time[i];\n    const tempMax = data.daily.temperature_2m_max[i];\n    const tempMin = data.daily.temperature_2m_min[i];\n\n    const icon = weatherIcon(data.daily.weather_code[i]);\n\n    forecastContainer.innerHTML += `\n      <div class=\"card py-4 px-2.5\">\n        <h3 class=\"card__title\">\n          ${isoToDate(day, \"weekday\")}\n        </h3>\n        <img src=\"${icon}\" alt=\"Weather Icon\" class=\"card__icon\">\n        <div class=\"card__temperatures flex justify-between\">\n          <p class=\"card__temperature\">\n            ${Math.round(tempMax)}<sup>${data.daily_units.temperature_2m_max}</sup>\n          </p>\n          <p class=\"card__temperature card__temperature--low\">\n            ${Math.round(tempMin)}<sup>${data.daily_units.temperature_2m_max}</sup>\n          </p>\n        </div>\n      </div>\n    `;\n  }\n\n  // Update hourly forecast\n  const hourlyContainer = document.querySelector('.hourly_container');\n  hourlyContainer.innerHTML = \"\";\n\n  // Trouver l'index de l'heure actuelle\n  const now = new Date();\n  const startIndex = data.hourly.time.findIndex(time => {\n    return new Date(time) >= now;\n  });\n\n  for (let i = startIndex; i < startIndex + 8; i++) {\n    const hourlyTemp = data.hourly.temperature_2m[i];\n    const hourlyIcon = weatherIcon(data.hourly.weather_code[i]);\n    const hourlyTime = formatHour(data.hourly.time[i]);\n\n    hourlyContainer.innerHTML += `\n      <div class=\"hourly_container card card--light flex flex-row items-center justify-between mt-4 py-2 px-3\">\n        <div class=\"flex flex-row items-center\">\n          <img src=\"${hourlyIcon}\" alt=\"\" class=\"card__icon w-10\">\n          <p class=\"card__hour ml-2\">${hourlyTime}</p>\n        </div>\n  \n        <p class=\"card__temperature\">${hourlyTemp}<sup>°</sup></p>\n      </div>\n    `;\n  };\n}\n\n// Update weather icon en fonction du weather code\nfunction weatherIcon(weatherCode) {\n  if (weatherCode === 0) {\n    return \"./assets/images/icon-sunny.webp\";\n  };\n  if (weatherCode === 2) {\n    return \"./assets/images/icon-partly-cloudy.webp\";\n  } \n  if (weatherCode === 1 || weatherCode === 3) {\n    return \"./assets/images/icon-overcast.webp\";\n  };\n  if (weatherCode === 45 || weatherCode ===  48) {\n    return \"./assets/images/icon-fog.webp\";\n  }\n  if (weatherCode === 53) {\n    return \"./assets/images/icon-drizzle.webp\";\n  }\n  if (weatherCode === 63) {\n    return \"./assets/images/icon-rain.webp\";\n  }\n  if (weatherCode === 73) {\n    return \"./assets/images/icon-snow.webp\";\n  }\n  if (weatherCode === 95) {\n    return \"./assets/images/icon-storm.webp\";\n  }\n  return \"./assets/images/icon-sunny.webp\";\n}\n\n// Dropdown display toggle\nconst dropdown = document.querySelector('.dropdown-content');\nconst buttonDropdown = document.querySelector('.dropdown-button');\n\nbuttonDropdown.addEventListener('click', () => {\n  dropdown.style.display =\n    dropdown.style.display === \"block\" ? \"none\" : \"block\";\n});\n\n// Fetch weather depending on city (value) and unit\nfunction fetchWeather({ value }) {\n  return(\n    fetch(`http://localhost:3002/api/search?q=${encodeURIComponent(value)}`)\n    .then(res => res.json())\n    .then(data => {\n      if (!data.length) {\n        // TO DO: ERROR PAGE\n        alert('Aucun résultat trouvé !');\n        return;\n      }\n\n      const { lat, lon, display_name } = data[0];\n\n      // Transformation du display name pour n'afficher que la ville et le pays\n      const locationName = display_name.split(\",\");\n\n      const locationResult = locationName[0].trim() + \", \" + locationName[locationName.length - 1].trim();\n\n      document.getElementById(\"location\").textContent = locationResult;\n\n      // Deuxième fetch pour aller récupérer les données de l'API Open Meteo\n      const url = buildMeteoUrl(lat, lon);\n      return fetch(url);\n    })\n  );\n}\n\n// Memorize city and metrics\nlet currentCity = 'Berlin';\nlet currentUnit = 'metric';\n\n// Handle different buttons listeners\nsearchButton.addEventListener('click', () => {\n  const value = input.value;\n  currentCity = value;\n\n  refreshWeather();\n});\n\nbtnMetric.addEventListener('click', () => {\n  // Change metric\n  currentUnit = currentUnit === 'metric' ? 'imperial' : 'metric';\n\n  currentUnit === 'imperial' ? btnMetric.innerHTML = 'Switch to Metric' : btnMetric.innerHTML = 'Switch to Imperial';\n\n  if (currentUnit === 'metric') {\n    weatherUnits.temperature = 'celsius';\n    weatherUnits.wind = 'kmh';\n    weatherUnits.precipitation = 'mm';\n  } else if (currentUnit === 'imperial') {\n    weatherUnits.temperature = 'fahrenheit';\n    weatherUnits.wind = 'mph';\n    weatherUnits.precipitation = 'in';\n  }\n\n  const tempRadio = document.querySelector(`input[name=\"temperature-unit\"][value=\"${weatherUnits.temperature}\"]`);\n  const windRadio = document.querySelector(`input[name=\"wind-unit\"][value=\"${weatherUnits.wind}\"]`);\n  const precipRadio = document.querySelector(`input[name=\"precipitation-unit\"][value=\"${weatherUnits.precipitation}\"]`);\n\n  if (tempRadio) tempRadio.checked = true;\n  if (windRadio) windRadio.checked = true;\n  if (precipRadio) precipRadio.checked = true;\n\n  refreshWeather();\n});\n\n// Make the individual unit selection\n// Global state\nconst weatherUnits = {\n  temperature: 'celsius',\n  wind: 'kmh',\n  precipitation: 'mm'\n};\n\nfunction buildMeteoUrl(lat, lon) {\n  const meteoUrlBase = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&daily=weather_code,temperature_2m_max,temperature_2m_min&current=temperature_2m,relative_humidity_2m,precipitation,wind_speed_10m,apparent_temperature,weather_code&hourly=temperature_2m,weather_code&timezone=auto`;\n\n  const params = [];\n\n  if (weatherUnits.temperature === 'fahrenheit') {\n    params.push('temperature_unit=fahrenheit');\n  }\n\n  if (weatherUnits.wind === 'mph') {\n    params.push('wind_speed_unit=mph');\n  }\n\n  if (weatherUnits.precipitation === 'in') {\n    params.push('precipitation_unit=inch');\n  }\n\n  return params.length\n    ? `${meteoUrlBase}&${params.join('&')}`\n  : meteoUrlBase;\n} \n\nfunction refreshWeather() {\n  fetchWeather({ value: currentCity })\n  .then(res => res.json())\n  .then(meteoData => {\n    updateWeatherUI(meteoData);\n  })\n  .catch(err => console.error(err));\n}\n\nfunction handleRadioGroup(selector, unitType) {\n  const inputs = document.querySelectorAll(selector);\n\n  inputs.forEach(input => {\n    input.addEventListener('change', (e) => {\n      if (e.target.checked) {\n        weatherUnits[unitType] = e.target.value;\n        refreshWeather();\n      }\n    })\n  })\n};\n\nhandleRadioGroup('input[name=\"temperature-unit\"]', 'temperature');\n\nhandleRadioGroup('input[name=\"wind-unit\"]', 'wind');\n\nhandleRadioGroup('input[name=\"precipitation-unit\"]', 'precipitation');"]}